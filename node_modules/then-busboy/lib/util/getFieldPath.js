"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _invariant = require("@octetstream/invariant");

var _invariant2 = _interopRequireDefault(_invariant);

var _isString = require("./isString");

var _isString2 = _interopRequireDefault(_isString);

var _getType = require("./getType");

var _getType2 = _interopRequireDefault(_getType);

var _isNaN = require("./isNaN");

var _isNaN2 = _interopRequireDefault(_isNaN);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const format = /^([^[\]\n]+)(\[[^[\]]+\])*$/;

/**
 * Get a fild path
 *
 * @param {string} fieldname
 *
 * @return {Array<string|number>}
 *
 * @throws {TypeError} when given fieldname is not a string
 * @throws {Error} on unexpected fieldname format
 *
 * @example
 *
 * getFieldPath("foo[bar][baz]") // -> ["foo", "bar", "baz"]
 *
 * getFieldPath("foo") // -> ["foo"]
 *
 * getFieldPath("42") // -> [42]
 */
function getFieldPath(fieldname) {
  const res = [];

  (0, _invariant2.default)(!(0, _isString2.default)(fieldname), TypeError, "Field name should be a string. Received %s", (0, _getType2.default)(fieldname));

  (0, _invariant2.default)(!fieldname, "Field name cannot be empty.");

  (0, _invariant2.default)(!format.test(fieldname), "Unexpected name format of the field: %s", fieldname);

  for (const element of fieldname.split("[")) {
    const key = element.endsWith("]") ? element.slice(0, -1) : element;

    res.push((0, _isNaN2.default)(key) ? key : Number(key));
  }

  return res;
}

exports.default = getFieldPath;